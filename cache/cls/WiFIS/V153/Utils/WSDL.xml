<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="WiFIS.V153.Utils.WSDL">
<Description>
Clase utilizada para modificar los WSDL para poder generar los WebServices y los clientes.</Description>
<Super>%RegisteredObject</Super>
<TimeCreated>63481,41148.501632</TimeCreated>

<Parameter name="SrcVer">
<Description>
Location and Revision of this file in Perforce (Auto-updating)</Description>
<Default>$Id$</Default>
</Parameter>

<Method name="Prepare">
<Description>
Modificaciones hechas a los ficheros WSDL.
pInputDir - Directorio de entrada donde están los ficheros WSDL.
pOutputDir  - Directorio de salida donde se guardarán los ficheros WSDL modificados.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pInputDir:%String="C:\Test\WIFIS\WSDL\input\",pOutputDir:%String="C:\Test\WIFIS\WSDL\output\"</FormalSpec>
<Implementation><![CDATA[
	set ret = $$$OK
	try {
		// *** Cites ***
		set input=pInputDir_"WiFIS_Cites.wsdl"
		set output=pOutputDir_"WiFIS_Cites.wsdl"
		set rep=$lb(
			$lb("[NS_PLATAFORMA]/","http://wifis.salut.gencat.net/"),
			$lb("[NS_PLATAFORMA]","http://wifis.salut.gencat.net/"),
			$lb("[INTF_PLATAFORMA]","Cites"),
			$lb("[SERVICE_PLATAFORMA]","CitesService"),
			$lb("[PORTNAME_PLATAFORMA]","Cites.WIFISHL7Port"),
			$lb("[BINDING_PLATAFORMA]","CitesBinding"),
			$lb("http://[servidor]:[port]/[plataformaInterficies]/[NomServei]","http://localhost/WiFIS/Cites"),
		)
		$$$THROWONERROR(tSC, ..Replace(input,output,.rep))
		
		// *** ConsultaDades ***
		set input=pInputDir_"WiFIS_Consulta.wsdl"
		set output=pOutputDir_"WiFIS_Consulta.wsdl"
		set rep=$lb(
			$lb("[NS_PLATAFORMA]/","http://wifis.salut.gencat.net/"),
			$lb("[NS_PLATAFORMA]","http://wifis.salut.gencat.net/"),
			$lb("[INTF_PLATAFORMA]","ConsultaDades"),
			$lb("[SERVICE_PLATAFORMA]","ConsultaDadesService"),
			$lb("[PORTNAME_PLATAFORMA]","ConsultaDades.WIFISHL7Port"),
			$lb("[BINDING_PLATAFORMA]","ConsultaDadesBinding"),
			$lb("http://[servidor]:[port]/[plataformaInterficies]/[NomServei]","http://localhost/WiFIS/ConsultaDades"),
		)
		$$$THROWONERROR(tSC, ..Replace(input,output,.rep))
		
		// *** Derivacions ***
		set input=pInputDir_"WiFIS_Derivacions.wsdl"
		set output=pOutputDir_"WiFIS_Derivacions.wsdl"
		set rep=$lb(
			$lb("[NS_PLATAFORMA]/","http://wifis.salut.gencat.net/"),
			$lb("[NS_PLATAFORMA]","http://wifis.salut.gencat.net/"),
			$lb("[INTF_PLATAFORMA]","Derivacions"),
			$lb("[SERVICE_PLATAFORMA]","DerivacionsService"),
			$lb("[PORTNAME_PLATAFORMA]","Derivacions.WIFISHL7Port"),
			$lb("[BINDING_PLATAFORMA]","DerivacionsBinding"),
			$lb("http://[servidor]:[port]/[plataformaInterficies]/[NomServei]","http://localhost/WiFIS/Derivacions"),
		)
		$$$THROWONERROR(tSC, ..Replace(input,output,.rep))
		
		// *** eConsultes ***
		set input=pInputDir_"WiFIS_eConsulta.wsdl"
		set output=pOutputDir_"WiFIS_eConsulta.wsdl"
		set rep=$lb(
			$lb("[NS_PLATAFORMA]/","http://wifis.salut.gencat.net/"),
			$lb("[NS_PLATAFORMA]","http://wifis.salut.gencat.net/"),
			$lb("[INTF_PLATAFORMA]","eConsultes"),
			$lb("[SERVICE_PLATAFORMA]","eConsultesService"),
			$lb("[PORTNAME_PLATAFORMA]","eConsultes.WIFISHL7Port"),
			$lb("[BINDING_PLATAFORMA]","eConsultesBinding"),
			$lb("http://[servidor]:[port]/[plataformaInterficies]/[NomServei]","http://localhost/WiFIS/eConsultes"),
		)
		$$$THROWONERROR(tSC, ..Replace(input,output,.rep))
		
		// *** Laboratori ***
		set input=pInputDir_"WiFIS_Laboratori.wsdl"
		set output=pOutputDir_"WiFIS_Laboratori.wsdl"
		set rep=$lb(
			$lb("[NS_PLATAFORMA]/","http://wifis.salut.gencat.net/"),
			$lb("[NS_PLATAFORMA]","http://wifis.salut.gencat.net/"),
			$lb("[INTF_PLATAFORMA]","Laboratori"),
			$lb("[SERVICE_PLATAFORMA]","LaboratoriService"),
			$lb("[PORTNAME_PLATAFORMA]","Laboratori.WIFISHL7Port"),
			$lb("[BINDING_PLATAFORMA]","LaboratoriBinding"),
			$lb("http://[servidor]:[port]/[plataformaInterficies]/[NomServei]","http://localhost/WiFIS/Laboratori"),
		)
		$$$THROWONERROR(tSC, ..Replace(input,output,.rep))
	} catch ex {
		set ret = ex.AsStatus()
	}
	quit ret
]]></Implementation>
</Method>

<Method name="Replace">
<Description>
Realiza reeemplazos de textos en un fichero.
pInput - Nombre del fichero de entrada
pOutput - Nombre del fichero de salida
pRep - Lista de reemplazos a realizar: $lb($lb(old1,new1),$lb(old2,new2),...)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[pInput:%String,pOutput:%String,&pRep]]></FormalSpec>
<Implementation><![CDATA[
	set ret = $$$OK
	try {
		set input = ##class(%Stream.FileCharacter).%New()
		set input.Filename = pInput
		
		set output = ##class(%Stream.FileCharacter).%New()
		set output.Filename = pOutput
		
		while 'input.AtEnd {
			set buf = input.Read(,.tSC)
			if $$$ISERR(tSC) $$$ThrowStatus(tSC)
			
			for i=1:1:$ll(pRep){
				set old=$lg($lg(pRep,i),1)
				set new=$lg($lg(pRep,i),2)
				set buf=$replace(buf,old,new)
			}
			$$$THROWONERROR(tSC, output.Write(buf))
		}
		$$$THROWONERROR(tSC, output.%Save())
	} catch ex {
		set ret = ex.AsStatus()
	}
	quit ret
]]></Implementation>
</Method>
</Class>
</Export>
